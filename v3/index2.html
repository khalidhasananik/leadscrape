<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Professional Information Collector</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
  body{
    min-height:100vh;display:flex;justify-content:center;align-items:center;
    background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);padding:20px;
  }
  .container{
    width:100%;max-width:680px;background:#fff;border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);padding:28px;
  }
  h1{font-size:1.8rem;color:#2c3e50;text-align:center;margin-bottom:10px}
  .description{ text-align:center;color:#7f8c8d;margin-bottom:22px;line-height:1.5 }
  .form-group{margin-bottom:16px}
  label{display:block;margin-bottom:6px;color:#34495e;font-weight:600}
  input{
    width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:8px;font-size:16px;
    transition:border-color .3s
  }
  input:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px rgba(52,152,219,.2)}
  button{
    width:100%;padding:14px;font-size:16px;font-weight:700;background:#3498db;color:#fff;
    border:none;border-radius:8px;cursor:pointer;transition:background .25s
  }
  button:hover{background:#2980b9}
  .loading{text-align:center;margin:26px 0;display:none}
  .spinner{
    width:50px;height:50px;border:5px solid rgba(52,152,219,.2);
    border-top-color:#3498db;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  .result{display:none;margin-top:26px;animation:fadeIn .4s ease-in}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  .section{background:#f9fbfd;border:1px solid #e6eef7;border-radius:10px;padding:16px;margin-bottom:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .field{flex:1 1 220px;background:#fff;border:1px solid #e6eef7;border-radius:8px;padding:10px}
  .label{font-size:12px;color:#6b7c93;text-transform:uppercase;letter-spacing:.04em;margin-bottom:4px}
  .value{color:#2c3e50;line-height:1.5;white-space:pre-wrap}
  .section h4{color:#2c3e50;margin-bottom:10px}
  .muted{color:#7f8c8d}
  .actions{margin-top:12px;display:flex;gap:10px;justify-content:flex-end}
  .actions button{width:auto;padding:10px 14px;font-size:14px}
  details{margin-top:10px}
  textarea{
    width:100%;height:220px;padding:12px;border:1px solid #ddd;border-radius:8px;
    font-size:12.5px;resize:vertical;background:#f9f9f9
  }
  .error{color:#b00020;background:#fde8ec;border:1px solid #f5c3cd;padding:10px;border-radius:8px}
  .link { color:#2d7af1; text-decoration:none }
  .link:hover { text-decoration:underline }
</style>
</head>
<body>
  <div class="container">
    <h1>Professional Information Collector</h1>
    <p class="description">
      Please provide your information below. The LinkedIn URL is optional.<br/>
      After submission, processing may take several minutes.
    </p>

    <!-- ---------- FORM ---------- -->
    <form id="infoForm">
      <div class="form-group">
        <label for="name">Full Name *</label>
        <input type="text" id="name" required placeholder="Enter your full name" />
      </div>
      <div class="form-group">
        <label for="company">Company *</label>
        <input type="text" id="company" required placeholder="Enter your company name" />
      </div>
      <div class="form-group">
        <label for="linkedin">LinkedIn URL <span class="muted">(optional)</span></label>
        <input type="url" id="linkedin" placeholder="https://linkedin.com/in/yourprofile" />
      </div>
      <button type="submit">Submit Information</button>
    </form>

    <!-- ---------- LOADING ---------- -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Processing your request, this might take several minutes...</p>
    </div>

    <!-- ---------- RESULT ---------- -->
    <div class="result" id="result">
      <div id="rendered"></div>

      <details>
        <summary class="muted">Show raw JSON</summary>
        <textarea id="rawJson" readonly></textarea>
      </details>

      <div class="actions">
        <button id="copyBtn" type="button">Copy JSON</button>
        <button id="clearBtn" type="button">New Entry</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const form      = document.getElementById('infoForm');
  const loading   = document.getElementById('loading');
  const result    = document.getElementById('result');
  const rendered  = document.getElementById('rendered');
  const rawJsonEl = document.getElementById('rawJson');
  const copyBtn   = document.getElementById('copyBtn');
  const clearBtn  = document.getElementById('clearBtn');

  // Basic HTML escape (and newline -> <br>) for safe rendering
  const escapeHTML = (str='') =>
    String(str)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');

  const formatMaybeLink = (label, url) => {
    if (!url) return '-';
    try {
      const u = new URL(url);
      const safe = escapeHTML(u.href);
      return `<a class="link" href="${safe}" target="_blank" rel="noopener noreferrer">${safe}</a>`;
    } catch { return escapeHTML(url); }
  };

function renderResponse(d) {
    // Top profile card
    const top = `
        <div class="section">
            <div class="row">
                <div class="field">
                    <div class="label"><strong>Full Name</strong></div>
                    <div class="value">${escapeHTML(d.fullName || '-')}</div>
                </div>
                <div class="field">
                    <div class="label"><strong>Headline</strong></div>
                    <div class="value">${escapeHTML(d.headline || '-')}</div>
                </div>
                <div class="field">
                    <div class="label"><strong>Company / Job Title</strong></div>
                    <div class="value">${escapeHTML([d.companyName, d.jobTitle].filter(Boolean).join(' â€” ') || '-')}</div>
                </div>
                <div class="field">
                    <div class="label"><strong>Connections / Followers</strong></div>
                    <div class="value">${escapeHTML(String(d.connections || '-'))} / ${escapeHTML(String(d.followers || '-'))}</div>
                </div>
                <div class="field">
                    <div class="label"><strong>LinkedIn</strong></div>
                    <div class="value">${formatMaybeLink('LinkedIn', d.linkedinUrl)}</div>
                </div>
            </div>
        </div>
    `;

    // Activity + summaries
    const summaries = `
        <div class="section">
            <h4>Highlights</h4>
            <div class="row">
                <div class="field">
                    <div class="label"><strong>Last Activity</strong></div>
                    <div class="value">${escapeHTML(d["Last Activity"] || '-')}</div>
                </div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Leads Summary</strong></div>
                    <div class="value">${escapeHTML(d["Leads Summary"] || '-')}</div>
                </div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Company Summary</strong></div>
                    <div class="value">${escapeHTML(d["Company Summary"] || '-')}</div>
                </div>
            </div>
        </div>
    `;

    // Contact/company details
    const contact = `
        <div class="section">
            <h4>Contact & Company</h4>
            <div class="row">
                <div class="field"><div class="label"><strong>Email</strong></div><div class="value">${escapeHTML(d.email || '-')}</div></div>
                <div class="field"><div class="label"><strong>Mobile</strong></div><div class="value">${escapeHTML(d.mobileNumber || '-')}</div></div>
                <div class="field"><div class="label"><strong>Industry</strong></div><div class="value">${escapeHTML(d.companyIndustry || '-')}</div></div>
                <div class="field"><div class="label"><strong>Company Website</strong></div><div class="value">${formatMaybeLink('Website', d.companyWebsite)}</div></div>
                <div class="field"><div class="label"><strong>Company LinkedIn</strong></div><div class="value">${formatMaybeLink('LinkedIn', d.companyLinkedin)}</div></div>
                <div class="field"><div class="label"><strong>Founded</strong></div><div class="value">${escapeHTML(d.companyFoundedIn || '-')}</div></div>
                <div class="field"><div class="label"><strong>Company Size</strong></div><div class="value">${escapeHTML(d.companySize || '-')}</div></div>
                <div class="field"><div class="label"><strong>Current Job Duration</strong></div><div class="value">${escapeHTML(d.currentJobDuration || '-')}</div></div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Address</strong></div><div class="value">${escapeHTML(d.addressWithoutCountry || '-')}</div>
                </div>
            </div>
        </div>
    `;

    // Skills / about / experience / education
    const details = `
        <div class="section">
            <h4>Details</h4>
            <div class="row">
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Top Skills</strong></div>
                    <div class="value">${escapeHTML(d.topSkillsByEndorsements || '-')}</div>
                </div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>About</strong></div>
                    <div class="value">${escapeHTML(d.about || '-')}</div>
                </div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Experience</strong></div>
                    <div class="value">${escapeHTML(d.experience || '-')}</div>
                </div>
                <div class="field" style="flex:1 1 100%">
                    <div class="label"><strong>Education</strong></div>
                    <div class="value">${escapeHTML(d.education || '-')}</div>
                </div>
            </div>
        </div>
    `;

    rendered.innerHTML = top + summaries + contact + details;
}

  // Submit -> call webhook -> render
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name     = document.getElementById('name').value.trim();
    const company  = document.getElementById('company').value.trim();
    const linkedin = document.getElementById('linkedin').value.trim() || null;
    const requestId = crypto.randomUUID();  // new

    form.style.display = 'none';
    loading.style.display = 'block';

    try {
      const webhookURL = 'https://noemi-multilaciniate-malia.ngrok-free.app/webhook/lead-scrape'; // prod URL
      const res = await fetch(webhookURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, company, linkedin, requestId }) // include requestId
      });
      if (!res.ok) throw new Error(`Webhook error: ${res.status}`);
      const data = await res.json();

      if (data.requestId && data.requestId !== requestId) {
        throw new Error('Response correlation mismatch (requestId).');
      }

      renderResponse(data);
      rawJsonEl.value = JSON.stringify(data, null, 2);
    } catch (err) {
      rendered.innerHTML = `<div class="error"><strong>Error:</strong> ${escapeHTML(err.message)}</div>`;
      rawJsonEl.value = `{"error":"${err.message}"}`;
    } finally {
      loading.style.display = 'none';
      result.style.display  = 'block';
    }
  });

    // Copy JSON
  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(rawJsonEl.value);
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy JSON', 1500);
    } catch {
      alert('Copy failed. Please select the text manually.');
    }
  });

  // Clear / new entry
  clearBtn.addEventListener('click', () => {
    form.reset();
    rendered.innerHTML = '';
    rawJsonEl.value = '';
    result.style.display = 'none';
    form.style.display   = 'block';
  });
});
</script>
</body>
</html>
